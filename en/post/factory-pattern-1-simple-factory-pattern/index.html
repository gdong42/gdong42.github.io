<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Introduction to Factory Pattern (1): Simple Factory Pattern - Gan&#39;s Blog - Dumps to digest.</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="author" content="Gan Dong" /><meta name="description" content="Nowadays, design patterns are not that popular to talk about. This could be related to the rapid iteration of web services, and the popularity of Micro Services. Design patterns were once considered useless dogma, thus as an anti-pattern, during the hype of Function Programming.
Of course, design patterns might have been thrown away as the essence of Object-Oriented Programming, because Functional Programming was preferred to OOP and was a hype during the time." /><meta name="keywords" content="Gan Dong, 董干, donggan, donggan.me" />






<meta name="generator" content="Hugo 0.57.2 with theme even" />


<link rel="canonical" href="https://donggan.me/en/post/factory-pattern-1-simple-factory-pattern/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.000d6e30802622fdc171e19eed218800c6c365d184567c00818f877d862fdbf5.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">
<link rel="stylesheet" href="/css/main.css">


<meta property="og:title" content="Introduction to Factory Pattern (1): Simple Factory Pattern" />
<meta property="og:description" content="Nowadays, design patterns are not that popular to talk about. This could be related to the rapid iteration of web services, and the popularity of Micro Services. Design patterns were once considered useless dogma, thus as an anti-pattern, during the hype of Function Programming.
Of course, design patterns might have been thrown away as the essence of Object-Oriented Programming, because Functional Programming was preferred to OOP and was a hype during the time." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://donggan.me/en/post/factory-pattern-1-simple-factory-pattern/" />
<meta property="article:published_time" content="2018-12-16T00:15:26+08:00" />
<meta property="article:modified_time" content="2019-10-06T00:12:23+08:00" />
<meta itemprop="name" content="Introduction to Factory Pattern (1): Simple Factory Pattern">
<meta itemprop="description" content="Nowadays, design patterns are not that popular to talk about. This could be related to the rapid iteration of web services, and the popularity of Micro Services. Design patterns were once considered useless dogma, thus as an anti-pattern, during the hype of Function Programming.
Of course, design patterns might have been thrown away as the essence of Object-Oriented Programming, because Functional Programming was preferred to OOP and was a hype during the time.">


<meta itemprop="datePublished" content="2018-12-16T00:15:26&#43;08:00" />
<meta itemprop="dateModified" content="2019-10-06T00:12:23&#43;08:00" />
<meta itemprop="wordCount" content="1964">



<meta itemprop="keywords" content="design patterns,OOP,Java,Simple Factory Pattern," />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Introduction to Factory Pattern (1): Simple Factory Pattern"/>
<meta name="twitter:description" content="Nowadays, design patterns are not that popular to talk about. This could be related to the rapid iteration of web services, and the popularity of Micro Services. Design patterns were once considered useless dogma, thus as an anti-pattern, during the hype of Function Programming.
Of course, design patterns might have been thrown away as the essence of Object-Oriented Programming, because Functional Programming was preferred to OOP and was a hype during the time."/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/en/" class="logo">Gan&#39;s Blog - Dumps to digest.</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/en/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/en/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/en/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/en/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a><a href="/en/about/">
        <li class="mobile-menu-item">About</li>
      </a><a href="/">
        <li class="mobile-menu-item">中文</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/en/" class="logo">Gan&#39;s Blog - Dumps to digest.</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/en/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/en/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/en/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/en/categories/">Categories</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/en/about/">About</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/">中文</a>
      </li>
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">Introduction to Factory Pattern (1): Simple Factory Pattern</h1>

      <div class="post-meta">
        <span class="post-time"> 2018-12-16 </span>
        <div class="post-category">
            <a href="/en/categories/how-to/"> how to </a>
            </div>
          <span class="more-meta"> 1964 words </span>
          <span class="more-meta"> 10 mins read </span>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Contents</h2>
  <div class="post-toc-content always-active">
    <nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#introduction">Introduction</a>
<ul>
<li><a href="#simple-factory-pattern">Simple Factory Pattern</a></li>
<li><a href="#pros-and-cons">Pros and Cons</a></li>
<li><a href="#real-example">Real Example</a></li>
</ul></li>
<li><a href="#a-step-further">A Step Further</a>
<ul>
<li><a href="#class-registration">Class Registration</a>
<ul>
<li><a href="#class-registration-with-reflection">Class Registration, with reflection</a></li>
<li><a href="#class-registration-without-reflection">Class Registration, without reflection</a></li>
</ul></li>
<li><a href="#factory-method-pattern">Factory Method Pattern</a></li>
</ul></li>
</ul></li>
</ul>
</nav>
  </div>
</div>
<div class="post-translations">
  <h5><i>This post is also available in following languages</i></h5>
  <ul>
    
    <li>
      <a href="https://donggan.me/post/factory-pattern-1-simple-factory-pattern/">[中文] 工厂模式简介（一）：简单工厂模式 (3314 words)</a>
    </li>
    
  </ul>
</div>


    <div class="post-content">
      

<p><img src="/img/james-kresser-1131299-unsplash-1024x618.jpg" alt="Cover Image" /></p>

<p>Nowadays, design patterns are not that popular to talk about. This could be related to the rapid iteration of web services, and the popularity of Micro Services. Design patterns were once considered useless dogma, thus as an anti-pattern, during the hype of Function Programming.</p>

<p>Of course, design patterns might have been thrown away as the essence of Object-Oriented Programming, because Functional Programming was preferred to OOP and was a hype during the time.</p>

<p>But if we think back, these design patterns are actually useful experiences extracted from practice. They do improve readability and scalability of programs to some extent. On the other hand, as well known conventions, design patterns deepen understanding between author and reader. In this sense, they can be considered as a medium of communication. Of course, this has to be used at correct scenarios. In terms of correct scenarios, we are talking about suitable scenarios — not using because we want to use, but for practical purpose.</p>

<p>In this blog post, I will introduce one of the most used design patterns: <strong>Factory Pattern</strong>, and talk about my understanding on it.</p>

<h2 id="introduction">Introduction</h2>

<p>Factory Pattern could arguably be the most widely used design pattern in Java. This type of design pattern comes under creational pattern as this pattern provides one of the best ways to create object. In Factory pattern, we create an object through a factory without exposing the creation logic to the client and refer to newly created object using a common interface.</p>

<p>Let’s first look at the simplist factory pattern.</p>

<h3 id="simple-factory-pattern">Simple Factory Pattern</h3>

<p>In my daily coding life, Simple Factory Pattern is enough to use. It suits well when we want to use a factory class to encapsulate creation logic of some product class that we would like to create. This product class can be extended by many sub-classes, which we are usually not interested in. We would rather like the factory to do its work, choose suitable sub-classes and create corresponding instances, by passing type information into the factory method.</p>

<p>Let’s look at a concret example.</p>

<p>Say we have a product class called <code>Car</code>, stands for cars. Different car factory can manufactory different cars, which can be considered as sub-classes of <code>Car</code>. So we can have <code>BmwCar</code>, <code>VolvoCar</code>, <code>TeslaCar</code>, and so on, demonstrated below.</p>

<figure>
    <img src="/img/simple-factory.png"/> <figcaption>
            <h4>A Simple Factory Example Diagram</h4>
        </figcaption>
</figure>


<p>Suppose we have a magic car factory called <code>CarFactory</code>, which is able to create multiple brands of cars. In order words, it can create <code>BmwCar</code>, <code>VolvoCar</code> and <code>TeslaCar</code>. When some type of <code>Car</code> is requested, the only thing to do is to tell the <code>CarFactory</code> what type of <code>Car</code> to create, and leave creating the car to this factory. How the car is manufactured does not concern, only that the factory will deliver the car fufilling all the requirements concerns.</p>

<p>As a client of this factory, how do I tell <code>CarFactory</code> which type of cars to create? It can be passed to <code>createCar()</code> method of <code>CarFactory</code> via method arguments.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="n">Car</span> <span class="nf">car1</span> <span class="o">=</span> <span class="n">SimpleCarFactory</span><span class="p">.</span><span class="na">createCar</span><span class="p">(</span><span class="n">CarType</span><span class="p">.</span><span class="na">BMW</span><span class="p">);</span>
<span class="n">car1</span><span class="p">.</span><span class="na">drive</span><span class="p">();</span>

<span class="n">Car</span> <span class="nf">car2</span> <span class="o">=</span> <span class="n">SimpleCarFactory</span><span class="p">.</span><span class="na">createCar</span><span class="p">(</span><span class="n">CarType</span><span class="p">.</span><span class="na">VOLVO</span><span class="p">);</span>
<span class="n">car2</span><span class="p">.</span><span class="na">drive</span><span class="p">();</span>

<span class="n">Car</span> <span class="nf">car3</span> <span class="o">=</span> <span class="n">SimpleCarFactory</span><span class="p">.</span><span class="na">createCar</span><span class="p">(</span><span class="n">CarType</span><span class="p">.</span><span class="na">TESLA</span><span class="p">);</span>
<span class="n">car3</span><span class="p">.</span><span class="na">drive</span><span class="p">();</span></code></pre></td></tr></table>
</div>
</div>
<p>Inside this <code>createCar()</code> method, the factory can choose the actual car type to create based on arguments passed in.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="nf">class</span> <span class="n">SimpleCarFactory</span> <span class="p">{</span>

  <span class="kd">public</span> <span class="nf">static</span> <span class="n">Car</span> <span class="nf">createCar</span><span class="p">(</span><span class="n">CarType</span> <span class="nf">type</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">type</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="n">IllegalArgumentException</span><span class="p">(</span><span class="s">&#34;type cannot be null&#34;</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">type</span> <span class="o">==</span> <span class="n">CarType</span><span class="p">.</span><span class="na">BMW</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">new</span> <span class="n">BmwCar</span><span class="p">();</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">type</span> <span class="o">==</span> <span class="n">CarType</span><span class="p">.</span><span class="na">VOLVO</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">new</span> <span class="n">VolvoCar</span><span class="p">();</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">type</span> <span class="o">==</span> <span class="n">CarType</span><span class="p">.</span><span class="na">TESLA</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">new</span> <span class="n">TeslaCar</span><span class="p">();</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="n">IllegalArgumentException</span><span class="p">(</span><span class="s">&#34;Unknown car type: &#34;</span> <span class="o">+</span> <span class="n">type</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span></code></pre></td></tr></table>
</div>
</div>
<p>See complete code example at this github repo: <a href="https://github.com/gdong42/factory-pattern">https://github.com/gdong42/factory-pattern</a></p>

<h3 id="pros-and-cons">Pros and Cons</h3>

<p>What’s the benefit of this pattern? In this pattern, the caller side does not need to know the exact type implementation and its creation details, it only provides the required type name information. So this pattern reduces the complexity of the client, and decouples the creation logic of various implementation from invocation logic to some extent.</p>

<p>What about the cons? Let’s think about it in real world. There are few such factories. Because this magical factory needs to know how to create every product, which is almost impossible. OOP reflects the real world, therefore it is not reasonable to have a super magic factory that can create all type of products as well in the software world. In other words, each time when we want to add a new car type, we need to update <code>createCar()</code>. This should better be avoided.</p>

<p>Another problem is that <code>SimpleCarFactory</code> class has to depend on all car types, due to the truth that it contains all creation invocation logic in one giant factory. This leads to the client code coupling all product types,  which might never be called by the client, and thus should be optional instead of mandatory dependencies. What we expect is that when we need some kind of product, we use a factory to create it, only with required dependency that has the underlying implementation module.</p>

<h3 id="real-example">Real Example</h3>

<p>In Java, an good example is the <code>String.valueOf()</code> method series.</p>

<p>The <code>String</code> class in Java represents a string. Sometimes, you need to get a string from a boolean or an integer. But <code>String</code> doesn’t provide constructors like <code>String(Integer i)</code> or <code>String(Boolean b)</code>. Instead, it provides multiple simple factory methods <code>String.valueOf(…)</code>.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kt">int</span> <span class="nf">i</span> <span class="o">=</span> <span class="n">12</span><span class="p">;</span>
<span class="n">String</span> <span class="nf">integerAsString</span> <span class="o">=</span> <span class="n">String</span><span class="p">.</span><span class="na">valueOf</span><span class="p">(</span><span class="n">i</span><span class="p">);</span></code></pre></td></tr></table>
</div>
</div>
<h2 id="a-step-further">A Step Further</h2>

<p>Let&rsquo;s take a step further and see how to improve this pattern to solve above problems.</p>

<p>There are two ways that might be useful to avoid the drawbacks mentioned above.</p>

<ol>
<li><p>Class Registration - maintain a mapping of the actual type and the name prameter of the type. This can be done with two flavors:</p>

<ul>
<li>with reflection</li>
<li>without reflection</li>
</ul></li>

<li><p>Factory Method Pattern - the famous pattern described in the book of GoF&rsquo;s design patterns.</p></li>
</ol>

<p>Next let&rsquo;s look at them in a bit more details.</p>

<h3 id="class-registration">Class Registration</h3>

<p>The registration can be done by invoking a registering method of the factory. The actual creation of the factory can be done using two ways: with or without reflection. Using this technique, we can maintain the name and type mappings in a HashMap in the factory. To allow registering new mappings, we need to add a method allowing new types to be registered. This way, adding new product types no longer requires any change in the factory class code.</p>

<h4 id="class-registration-with-reflection">Class Registration, with reflection</h4>

<p>For actual object creating logic, the type associated with the requesting type identifier is looked up from the internal mappings, and then the actual create instance logic is called by invoking the constructor using reflection. This can be demonstrated as followed.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="nf">static</span> <span class="kd">class</span> <span class="nf">CarFactoryWithReflection</span> <span class="p">{</span>

  <span class="kd">private</span> <span class="nf">Map</span><span class="o">&lt;</span><span class="n">CarType</span><span class="p">,</span> <span class="n">Class</span><span class="o">&lt;?</span> <span class="kd">extends</span> <span class="nf">Car</span><span class="o">&gt;&gt;</span> <span class="n">registeredCarTypes</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ConcurrentHashMap</span><span class="o">&lt;&gt;</span><span class="p">();</span>

  <span class="kd">private</span> <span class="nf">static</span> <span class="n">CarFactoryWithReflection</span> <span class="nf">INSTANCE</span><span class="p">;</span>

  <span class="kd">private</span> <span class="nf">CarFactoryWithReflection</span><span class="p">()</span> <span class="p">{</span>
  <span class="p">}</span>

  <span class="kd">public</span> <span class="nf">static</span> <span class="n">CarFactoryWithReflection</span> <span class="nf">instance</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">INSTANCE</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">INSTANCE</span> <span class="o">=</span> <span class="k">new</span> <span class="n">CarFactoryWithReflection</span><span class="p">();</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">INSTANCE</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="kd">public</span> <span class="nf">void</span> <span class="n">registerCar</span><span class="p">(</span><span class="n">CarType</span> <span class="nf">type</span><span class="p">,</span> <span class="n">Class</span><span class="o">&lt;?</span> <span class="kd">extends</span> <span class="nf">Car</span><span class="o">&gt;</span> <span class="n">carClass</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="na">registeredCarTypes</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">type</span><span class="p">,</span> <span class="n">carClass</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="kd">public</span> <span class="nf">Car</span> <span class="n">createCar</span><span class="p">(</span><span class="n">CarType</span> <span class="nf">type</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">type</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="n">IllegalArgumentException</span><span class="p">(</span><span class="s">&#34;type cannot be null&#34;</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">Class</span><span class="o">&lt;?</span> <span class="kd">extends</span> <span class="nf">Car</span><span class="o">&gt;</span> <span class="n">carClass</span> <span class="o">=</span> <span class="n">registeredCarTypes</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">type</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">carClass</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="n">RuntimeException</span><span class="p">(</span><span class="s">&#34;Car type not registered: &#34;</span> <span class="o">+</span> <span class="n">type</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">try</span> <span class="p">{</span>
      <span class="n">Constructor</span><span class="o">&lt;?</span> <span class="kd">extends</span> <span class="nf">Car</span><span class="o">&gt;</span> <span class="n">carConstructor</span> <span class="o">=</span> <span class="n">carClass</span>
          <span class="p">.</span><span class="na">getDeclaredConstructor</span><span class="p">();</span>
      <span class="k">return</span> <span class="n">carConstructor</span><span class="p">.</span><span class="na">newInstance</span><span class="p">();</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="nf">e</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="n">RuntimeException</span><span class="p">(</span>
          <span class="s">&#34;Car of type &#34;</span> <span class="o">+</span> <span class="n">type</span> <span class="o">+</span> <span class="s">&#34; cannot be instantiated&#34;</span><span class="p">,</span> <span class="n">e</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span></code></pre></td></tr></table>
</div>
</div>
<p>This approach requires one to register a car type to the factory before calling the <code>createCar</code> method. It can be done by calling the <code>registerCar</code> method explicitly from the client code. For example,</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java">    <span class="kd">public</span> <span class="nf">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="p">[]</span> <span class="nf">args</span><span class="p">)</span> <span class="p">{</span>

      <span class="n">CarFactoryWithReflection</span><span class="p">.</span><span class="na">instance</span><span class="p">()</span>
          <span class="p">.</span><span class="na">registerCar</span><span class="p">(</span><span class="n">CarType</span><span class="p">.</span><span class="na">BMW</span><span class="p">,</span> <span class="n">BmwCar</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
      <span class="n">CarFactoryWithReflection</span><span class="p">.</span><span class="na">instance</span><span class="p">()</span>
          <span class="p">.</span><span class="na">registerCar</span><span class="p">(</span><span class="n">CarType</span><span class="p">.</span><span class="na">VOLVO</span><span class="p">,</span> <span class="n">VolvoCar</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
      <span class="n">CarFactoryWithReflection</span><span class="p">.</span><span class="na">instance</span><span class="p">()</span>
          <span class="p">.</span><span class="na">registerCar</span><span class="p">(</span><span class="n">CarType</span><span class="p">.</span><span class="na">TESLA</span><span class="p">,</span> <span class="n">TeslaCar</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>

      <span class="n">Car</span> <span class="nf">car1</span> <span class="o">=</span> <span class="n">CarFactoryWithReflection</span><span class="p">.</span><span class="na">instance</span><span class="p">().</span><span class="na">createCar</span><span class="p">(</span><span class="n">CarType</span><span class="p">.</span><span class="na">BMW</span><span class="p">);</span>
      <span class="n">car1</span><span class="p">.</span><span class="na">drive</span><span class="p">();</span>

      <span class="n">Car</span> <span class="nf">car2</span> <span class="o">=</span> <span class="n">CarFactoryWithReflection</span><span class="p">.</span><span class="na">instance</span><span class="p">().</span><span class="na">createCar</span><span class="p">(</span><span class="n">CarType</span><span class="p">.</span><span class="na">VOLVO</span><span class="p">);</span>
      <span class="n">car2</span><span class="p">.</span><span class="na">drive</span><span class="p">();</span>

      <span class="n">Car</span> <span class="nf">car3</span> <span class="o">=</span> <span class="n">CarFactoryWithReflection</span><span class="p">.</span><span class="na">instance</span><span class="p">().</span><span class="na">createCar</span><span class="p">(</span><span class="n">CarType</span><span class="p">.</span><span class="na">TESLA</span><span class="p">);</span>
      <span class="n">car3</span><span class="p">.</span><span class="na">drive</span><span class="p">();</span>
    <span class="p">}</span></code></pre></td></tr></table>
</div>
</div>
<p>This reflection implementation has its own drawbacks.</p>

<ul>
<li>Performance.</li>
<li>Cannot handle well when product has complex constructor parameters.</li>
<li>The registering logic seems a burden that the client needs to bear with.</li>
</ul>

<h4 id="class-registration-without-reflection">Class Registration, without reflection</h4>

<p>If for some reason we cannot use reflection, how to do the registration? We can move the registration to the concrete product class itself. This way, the factory does not require knowledge of the concrete product class. Adding new product type does not require changes to the factory as well.</p>

<p>We first add a new method in the abstract product interface, which is <code>Car</code> in our case.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="nf">interface</span> <span class="n">Car</span> <span class="p">{</span>

  <span class="p">...</span>

  <span class="n">Car</span> <span class="nf">create</span><span class="p">();</span>

<span class="p">}</span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="nf">class</span> <span class="n">BmwCar</span> <span class="nf">implements</span> <span class="n">Car</span> <span class="p">{</span>

  <span class="kd">static</span> <span class="p">{</span>
    <span class="n">CarFactoryWithoutReflection</span><span class="p">.</span><span class="na">instance</span><span class="p">()</span>
        <span class="p">.</span><span class="na">registerCar</span><span class="p">(</span><span class="n">CarType</span><span class="p">.</span><span class="na">BMW</span><span class="p">,</span> <span class="k">new</span> <span class="n">BmwCar</span><span class="p">());</span>
  <span class="p">}</span>

  <span class="p">...</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="nf">Car</span> <span class="n">create</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">BmwCar</span><span class="p">();</span>
  <span class="p">}</span>
<span class="p">}</span></code></pre></td></tr></table>
</div>
</div>
<p>Above we register the <code>Car</code> instance into the Factory registration map. We also implement the <code>create()</code> method to produce new instances of <code>BmwCar</code> when required.</p>

<p>The factory and its usage look like below:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java">  <span class="kd">public</span> <span class="nf">static</span> <span class="kd">class</span> <span class="nf">CarFactoryWithoutReflection</span> <span class="p">{</span>

    <span class="kd">private</span> <span class="nf">Map</span><span class="o">&lt;</span><span class="n">CarType</span><span class="p">,</span> <span class="n">Car</span><span class="o">&gt;</span> <span class="nf">registeredCars</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ConcurrentHashMap</span><span class="o">&lt;&gt;</span><span class="p">();</span>

    <span class="kd">private</span> <span class="nf">static</span> <span class="n">CarFactoryWithoutReflection</span> <span class="nf">INSTANCE</span><span class="p">;</span>

    <span class="kd">private</span> <span class="nf">CarFactoryWithoutReflection</span><span class="p">()</span> <span class="p">{</span>
    <span class="p">}</span>

    <span class="kd">public</span> <span class="nf">static</span> <span class="n">CarFactoryWithoutReflection</span> <span class="nf">instance</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">INSTANCE</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">INSTANCE</span> <span class="o">=</span> <span class="k">new</span> <span class="n">CarFactoryWithoutReflection</span><span class="p">();</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="n">INSTANCE</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">public</span> <span class="nf">void</span> <span class="n">registerCar</span><span class="p">(</span><span class="n">CarType</span> <span class="nf">type</span><span class="p">,</span> <span class="n">Car</span> <span class="nf">car</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="na">registeredCars</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">type</span><span class="p">,</span> <span class="n">car</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kd">public</span> <span class="nf">Car</span> <span class="n">createCar</span><span class="p">(</span><span class="n">CarType</span> <span class="nf">type</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">type</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="n">IllegalArgumentException</span><span class="p">(</span><span class="s">&#34;type cannot be null&#34;</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="n">Car</span> <span class="nf">car</span> <span class="o">=</span> <span class="n">registeredCars</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">type</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">car</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="n">RuntimeException</span><span class="p">(</span><span class="s">&#34;Car type not registered: &#34;</span> <span class="o">+</span> <span class="n">type</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="n">car</span><span class="p">.</span><span class="na">create</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="c1">// make sure car type is registered to the factory before creating cars
</span><span class="c1"></span>    <span class="kd">static</span> <span class="p">{</span>
      <span class="k">try</span> <span class="p">{</span>
        <span class="n">Class</span><span class="p">.</span><span class="na">forName</span><span class="p">(</span><span class="s">&#34;me.donggan.patterns.factory.simple.model.BmwCar&#34;</span><span class="p">);</span>
        <span class="n">Class</span><span class="p">.</span><span class="na">forName</span><span class="p">(</span><span class="s">&#34;me.donggan.patterns.factory.simple.model.VolvoCar&#34;</span><span class="p">);</span>
        <span class="n">Class</span><span class="p">.</span><span class="na">forName</span><span class="p">(</span><span class="s">&#34;me.donggan.patterns.factory.simple.model.TeslaCar&#34;</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">ClassNotFoundException</span> <span class="nf">cnfe</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">cnfe</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
      <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">public</span> <span class="nf">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="p">[]</span> <span class="nf">args</span><span class="p">)</span> <span class="p">{</span>

      <span class="n">Car</span> <span class="nf">car1</span> <span class="o">=</span> <span class="n">CarFactoryWithoutReflection</span><span class="p">.</span><span class="na">instance</span><span class="p">().</span><span class="na">createCar</span><span class="p">(</span><span class="n">CarType</span><span class="p">.</span><span class="na">BMW</span><span class="p">);</span>
      <span class="n">car1</span><span class="p">.</span><span class="na">drive</span><span class="p">();</span>

      <span class="n">Car</span> <span class="nf">car2</span> <span class="o">=</span> <span class="n">CarFactoryWithoutReflection</span><span class="p">.</span><span class="na">instance</span><span class="p">().</span><span class="na">createCar</span><span class="p">(</span><span class="n">CarType</span><span class="p">.</span><span class="na">VOLVO</span><span class="p">);</span>
      <span class="n">car2</span><span class="p">.</span><span class="na">drive</span><span class="p">();</span>

      <span class="n">Car</span> <span class="nf">car3</span> <span class="o">=</span> <span class="n">CarFactoryWithoutReflection</span><span class="p">.</span><span class="na">instance</span><span class="p">().</span><span class="na">createCar</span><span class="p">(</span><span class="n">CarType</span><span class="p">.</span><span class="na">TESLA</span><span class="p">);</span>
      <span class="n">car3</span><span class="p">.</span><span class="na">drive</span><span class="p">();</span>
    <span class="p">}</span>

  <span class="p">}</span></code></pre></td></tr></table>
</div>
</div>
<p>This non-reflection implementation has its own drawbacks as well.</p>

<ul>
<li>The client code need to call <code>Class.forName()</code> explicitly in order to make sure the registration logic is invoked, which is not convenient.</li>
<li>The concrete product class requires to know the presence of the Factory, and needs to call its register logic.</li>
</ul>

<p>In the real world, the registration part is usually presented by some kind of  framework, thus above drawbacks can be mitigated.</p>

<h3 id="factory-method-pattern">Factory Method Pattern</h3>

<p>If we take a second thought on above non-reflection class registration, it has a <code>create()</code> method in the <code>Car</code> interface. This is an abstrace method that is used to encapsulate the creation logic to the concrete product itself. It looks more like what a factory does.</p>

<p>Besides, the example registers a <code>Car</code> instance in the static code, which is solely used to be called with the <code>create()</code> method to create other <code>Car</code> instances. See? the design is a bit awkward.</p>

<p>If we make the factory specific to each concrete car types, maybe we can use <code>CarFactory</code> type and <code>BmwCarFactory</code>, <code>TeslaCarFactory</code> and <code>VolvoCarFactory</code> subtypes to <em>create</em> concrete car types. This way some awkwardness above can be avoided. In fact, this leads us to the <strong>Factory Method Pattern</strong>.</p>

<p>In <a href="/en/post/factory-pattern-2-factory-method">next installment of this article</a>, I will talk about <em>Factory Method Pattern</em>.</p>

    </div>

    <div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">Author</span>
    <span class="item-content">Gan Dong</span>
  </p>
  <p class="copyright-item">
    <span class="item-title">LastMod</span>
    <span class="item-content">
        2019-10-06
        
    </span>
  </p>
  
  
</div>
<footer class="post-footer">
      <div class="post-tags">
          <a href="/en/tags/design-patterns/">design patterns</a>
          <a href="/en/tags/oop/">OOP</a>
          <a href="/en/tags/java/">Java</a>
          <a href="/en/tags/simple-factory-pattern/">Simple Factory Pattern</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/en/post/factory-pattern-2-factory-method/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">Introduction to Factory Pattern (2): Factory Method</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        <a class="next" href="/en/post/golangs-ridiculous-common-initialisms/">
            <span class="next-text nav-default">Golang&#39;s Ridiculous Common Initialisms</span>
            <span class="next-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        <div id="disqus_thread"></div>
    <script type="text/javascript">
    (function() {
      
      
      if (window.location.hostname === 'localhost') return;

      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      var disqus_shortname = 'donggan-me';
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
      <a href="https://twitter.com/__gdong__" class="iconfont icon-twitter" title="twitter"></a>
  <a href="https://donggan.me/en/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2014 - 
    2022<span class="heart"><i class="iconfont icon-heart"></i></span><span>董干</span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>



<script type="text/javascript" src="/js/main.min.c12618f9a600c40bd024996677e951e64d3487006775aeb22e200c990006c5c7.js"></script>


<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-77549857-2', 'auto');
	ga('set', 'anonymizeIp', true);
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>







</body>
</html>
